---
title: "Untitled"
output: html_document
date: "2023-05-31"
---
5.2 Burbujas
Tres investigadoras quieren analizar el efecto que tienen las diferentes proporciones
de glicerina y tipo de agua utilizados en la mezcla para la confección de burbujas,
sobre el tiempo promedio de resistencia de las mismas. Se obtiene una mezcla simple
y posteriormente se ajusta al propósito de la investigación. En la mezcla se van
variando el tipo de agua (destilada, grifo, añejada) y la cantidad de glicerina (60ml,
120ml). A partir de estos factores se obtienen 6 tratamientos.
El experimento se realiza con 6 personas que funcionan como bloques, cada una
de las cuales hace 5 burbujas con cada tratamiento, para un total de 30 burbujas
por persona. El orden en que cada persona tiene que utilizar un tipo de mezcla se
aleatoriza de la siguiente manera: por cada persona se aleatorizan los 6 tratamientos
con repeticiones hasta completar 5 burbujas por tratamiento.
La variable respuesta es el tiempo promedio de resistencia de las burbujas (en
minutos) de cada tratamiento para cada persona, lo cual da un total de 36 valores
de la respuesta. Aunque cada persona (bloque) hace 30 burbujas, solo se tienen
6 valores de la respuesta por persona, uno para cada tratamiento. En este caso el
promedio de las 5 burbujas es una mejor medida de la resistencia que se obtiene en
un tratamiento en un persona específica, ya que puede haber muchísima variación
entre esa resistencia de una burbuja a otra aún cuando sean hechas por la misma
persona y con el mismo tratamiento.
5.2.1 Ejercicios
1. Preparación:
(a) Cargue el archivo burbujas.Rdata que contiene tres bases de datos: 1)
base1 que contiene los datos solamente con el factor glicerina, 2) base2
que contiene solamente el factor agua, y 3) base en donde se tienen ambos.
```{r}
load("Bases/burbujas.Rdata")
str(base)
str(base1)
str(base2)
```

(b) Asegúrese que en todas las bases se han definido adecuadamente los
factores glicerina y agua. Además, la persona es el bloque, y también tiene
que estar definido como factor.


Para base
```{r}
str(base)
base$bloque=as.factor(base$bloque)
base$glicerina=as.factor(base$glicerina)
str(base)
```
Para base1
```{r}
str(base1)
base1$bloque=as.factor(base1$bloque)
base1$glicerina=as.factor(base1$glicerina)
str(base1)
```
Para base2
```{r}
str(base2)
base2$bloque=as.factor(base2$bloque)
str(base2)
```

2. Visualización de datos con glicerina:
(a) Realice la visualización usando base1. Haga un gráfico de líneas para ver el
comportamiento de los tratamientos dentro de cada persona. Use ggplot2
con la persona en el eje X y poniendo group=glicerina para que haga una
línea para cada tratamiento.
```{r}
library(ggplot2)

ggplot(base1,aes(x=bloque,y=tiempo,group=glicerina)) +
stat_summary(fun.y="mean", geom="line", aes(linetype = glicerina))+
labs(x = "persona")
```

(b) Observe si se puede esperar que haya diferencia entre las medias de los
tratamientos.

si se observa diferencias en las medias de los tratamientos del factor glicerina

(c) Observe si hay alguna tendencia de valores más altos o más bajos para
ciertas personas.

La persona 5 tiene una tendencia a valores altos en glicerina(60,120), ademas la persona tres tiene valores altos para el tratamiento glicerina(120) y bajos para glicerina(60)

(d) ¿Se observa interacción entre glicerina y persona?

si se observa interacion entre glicerina y el bloque persona

(e) ¿Se podría verificar la hipótesis de no interacción?

Cuando hay solo una observación por tratamiento para cada bloque, no se
puede verificar la hipótesis de no interacción porque no se tienen grados de
libertad para los residuales. En ese caso se dice que el efecto de interacción
se confunde con el residual y se toma la variancia residual asumiendo que la
variancia de interacción es nula, principalmente porque esta variancia residual
es fundamental para hacer la verificación de otras pruebas.

(f) Centre los datos de tiempo dentro de cada persona,es decir, se quiere
quitar el efecto del bloque restando la media del bloque al que una
observación pertenece. Para centrar los datos, ajuste un modelo solamente
con el bloque como factor usando lm(tiempo~persona), y obtenga los
valores ajustados usando mod$fit. Luego reste a cada respuesta estos
valores ajustados, con lo cual en realidad está centrando los datos dentro
de cada persona. Finalmente, sume la media general de la respuesta.

*centrar datos tiempo
*quitar efecto del bloque restando media del bloque
*modelo con bloque como factor lm(tiempo~persona)
*obtener valores con mod$fit (ajustados)
*restar a cada respuesta estos valores
*sumar media general de la respuesta

```{r}
mod=lm(base1$tiempo~base1$bloque)
fit=mod$fit
base1$fit=base1$tiempo-fit+mean(base1$tiempo)
```

(g) Haga dos gráficos para ver la variabilidad del tiempo en los 2 niveles de
glicerina: 1) use los datos originales, 2) use los tiempos centrados. Ponga
los dos gráficos uno al lado del otro y asegúrese que ambos gráficos tienen
el mismo rango en el eje Y.
```{r}
par(mfrow=c(1,2))
plot(base1$tiempo~base1$glicerina);plot(base1$fit~base1$glicerina)
```

(h) Observe la variabilidad de los residuales en ambos gráficos. ¿A qué se
deben las diferencias? Observe si se puede justificar el cumplimiento del
supuesto de homocedasticidad.

En el gráfico con los datos originales (izquierda) se observa una
mayor variabilidad en el nivel 120 de glicerina, la cual se debe principalmente a
las diferencias entre bloques, es decir, las diferencias entre personas. Al eliminar
esas diferencias se observa en el gráfico de la derecha que la variabilidad se ha
reducido. Ahora la variabilidad es más parecida en los dos tratamientos por lo
que se podría pensar que la homocedasticidad sí se cumple.


3. Variancia residual:
(a) Estime dos modelos: 1) uno incluyendo el factor de diseño y el bloque
con el tiempo original como respuesta, 2) otro incluyendo sólo el factor de
diseño con el tiempo centrado como respuesta.

```{r}

```

(b) Compare los análisis de variancia de ambos modelos. Observe la suma de
cuadrados total, la suma de cuadrados residual y los grados de libertad de
ambos modelos.
(c) ¿Cuál es la forma correcta de obtener la variancia residual?
(d) Estime la variancia del error.
(e) ¿Qué representa esta variancia?
4. Homocedasticidad:
(a) Verifique el supuesto de homocedasticidad. No se pueden usar los tiempos
originales puesto que debe considerarse la presencia de los bloques. La
homocedasticidad es un supuesto que dice que la variancia condicional
de la respuesta para cada tratamiento es la misma, lo cual implica
que también los errores de los diferentes tratamientos tengan la misma
variancia. En este caso, se recomienda obtener los residuales del modelo
con bloques y luego hacer la prueba sobre estos residuales con el factor de
la siguiente forma: bartlett.test(mod2$res~glicerina).
5. Conclusión:
(a) Concluya basado en el modelo que hace los cálculos adecuados.
6. Análisis con tipos de agua:
(a) Realice la visualización usando los datos con tres tipos de agua (base2).
(b) Use el modelo adecuado y verifique si se cumple el supuesto de
homocedasticidad.
(c) Pruebe la hipótesis sobre el efecto del tipo de agua y concluya.
(d) Lleve a cabo las comparaciones adecuadas entre los promedios de tiempo
para los tres tipos de agua.
7. Análisis con ambos factores.
(a) Use base. Visualice los datos. Como se trata de dos factores se pueden
centrar los datos por bloque y hacer un boxplot con ambos factores. Para
esto se incluyen los factores separados por +. Haga un gráfico con los
datos centrados como respuesta y ponga glicerina+agua, y otro gráfico
poniendo agua+glicerina.
(b) Analice si existe interacción entre glicerina y agua.
(c) Pruebe si hay efecto de la glicerina en este nuevo diseño.
(d) Cuantifique la diferencia con un nivel de confianza de 95%.
(e) Pruebe si hay efecto del tipo de agua en este nuevo diseño.
(f) Verifique entre cuáles pares de medias hay diferencias y cuantifique
aquellas donde las diferencias son significativas. Use un nivel de
signficancia de 5% y un nivel de confianza de 95%.