---
title: "Untitled"
output: html_document
date: "2024-04-25"
---

Se examinan diversas variables que podrían estar vinculadas con la percepción de los estudiantes hacia el curso de Precálculo, dentro de las carreras ofrecidas por la Facultad de Ciencias Económicas de la Universidad de Costa Rica durante el primer ciclo del año 2019.

La muestra está compuesta por 107 estudiantes matriculados en alguna de las disciplinas de la Facultad de Ciencias Económicas, que incluyen Estadística, Economía, Dirección de Empresas, Administración Aduanera y Contaduría Pública.

Los participantes completaron un cuestionario a través de Google Forms.

El cuestionario utilizado para recopilar datos constaba de dos secciones: la primera sección abordaba aspectos sociodemográficos (edad, sexo, zona), así como variables relacionadas con la institución educativa de procedencia y experiencias previas en educación. La segunda sección incluía preguntas sobre la percepción del curso de Precálculo, el tiempo dedicado al estudio del mismo por parte de los estudiantes y, por último, la influencia de las charlas del CASE en su motivación.

Las variables utilizadas para evaluar la percepción del curso de Precálculo fueron las siguientes: 1) expectativas del curso, 2) evaluación (quices y exámenes), 3) comprensión de la explicación del profesor, 4) utilidad del material proporcionado en clase y 5) motivación derivada de las charlas del CASE.

Estas variables fueron evaluadas en una escala del 1 al 10, donde 1 representaba una percepción mínima y 10 una percepción máxima.

### Métodos Jerárquicos

1. **Construcción de la Base de Datos `base1` con Variables de Percepción:**
   
   Para esta sección, se creará una base de datos llamada `base1` que contendrá únicamente las variables de percepción.
```{r}
load("precalculo.Rdata")
base1=base[,c(19,20,21,22,24)]
```

2. **Distancia Euclidiana:**
   
   - Calcularemos la distancia euclidiana entre los primeros dos individuos utilizando la forma vectorial para el cálculo de esta distancia.
```{r}
x1=base1[1,]
x2=base1[2,]
d=as.matrix(x1-x2,ncol=1)
d=t(d)
d.EU=sqrt(t(d)%*%d)
round(d.EU,3)
```
   
   - Posteriormente, obtendremos la distancia euclidiana entre todos los pares de individuos utilizando la función `dist`.
```{r}
d.EU=dist(base1)
```
   
   - Extraeremos la distancia entre el individuo 1 y el individuo 2 de la matriz de distancias.
```{r}
as.matrix(d.EU)[2,1]
```

3. **Matriz de Covarianzas S:**
   
   - Calcularemos la matriz de covarianzas S.
```{r}
S=var(base1); S
```

   - Luego, calcularemos la distancia de Mahalanobis entre los primeros dos individuos utilizando la forma vectorial y
   obtendremos la matriz completa de distancias de Mahalanobis usando la función `D2.dist` de la librería `biotools`.
```{r}
x1=base1[1,]
x2=base1[2,]
d.MAH=as.matrix(x1-x2)
d.MAH=t(d.MAH)
d.MAH= sqrt(t(d.MAH)%*%solve(S)%*%d.MAH); round(d.MAH,3)
```
```{r}
#con biotools
library("biotools")
d.MAH=D2.dist(base1,S)
```

   - Extraeremos la distancia entre el individuo 1 y el individuo 2 de la matriz de distancias de Mahalanobis.
```{r}
as.matrix(d.MAH)[2,1] #El resultado es D**2
sqrt(as.matrix(d.MAH)[2,1])
```

4. **Distancia de Manhattan:**
   
   - Calcularemos la distancia de Manhattan entre los primeros dos individuos usando la forma vectorial.
```{r}
x1=base1[1,]
x2=base1[2,]
d.MANH=as.matrix(x1-x2)
sum(abs(d.MANH))
```

   - Obtendremos la matriz de distancias de Manhattan utilizando la función `dist` con el argumento `method = “manhattan”`.
```{r}
d.MANH=dist(base1,method = "manhattan")
as.matrix(d.MANH)
as.matrix(d.MANH)[2,1]
```

5. **Dendrograma:**
   
   Finalmente, obtendremos el dendrograma utilizando como distancia entre individuos la distancia Euclidiana y como distancia entre grupos el criterio del vecino más cercano (single). Esto se logra agrupando los datos con la función `hclust` y almacenando el resultado en un objeto llamado `cs`.

```{r}
cs= hclust(d.EU,method = "single")
```

Para generar el dendrograma, primero utilizamos la función `plot` de la siguiente manera:

```{r}
#Euclidea, vecino mas cercano
plot(cs, xlab="", main="Vecino más cercano Euclidea", ylab="Distancia", sub="")
```


Luego, exploramos otras distancias entre individuos manteniendo siempre el criterio del vecino más cercano.
```{r}
#Mahalanobis, vecino mas cercano
cs=hclust(d.MAH,method = "single")
plot(cs, xlab="", main="Vecino más cercano Mahalanobis", ylab="Distancia", sub="")
```
```{r}
#Manhatan, vecino mas cercano
cs=hclust(d.MANH,method = "single")
plot(cs, xlab="", main="Vecino más cercano Manhatan", ylab="Distancia", sub="")
```
5. **Vecino más lejano:**
   Cambiamos la distancia entre grupos al método del vecino más lejano (`method=”complete”` en `hclust`, que es el default) y generamos los dendrogramas correspondientes.
```{r}
#Euclidea, vecino mas lejano
cs= hclust(d.EU,method = "complete")
plot(cs, xlab="", main="Vecino más lejano Euclidea", ylab="Distancia", sub="")
```
```{r}
#Mahalanobis, vecino mas lejano
cs=hclust(d.MAH,method = "complete")
plot(cs, xlab="", main="Vecino más lejano Mahalanobis", ylab="Distancia", sub="")
```
```{r}
#Manhatan, vecino mas lejano
cs=hclust(d.MANH,method = "complete")
plot(cs, xlab="", main="Vecino más lejano Manhatan", ylab="Distancia", sub="")
```
6. **Salto promedio:**
   Usamos el salto promedio como distancia entre grupos (`method=”average”` en `hclust`) y obtenemos los dendrogramas correspondientes.
```{r}
#Euclidea, salto promedio
cs= hclust(d.EU,method = "average")
plot(cs, xlab="", main="salto promedio Euclidea", ylab="Distancia", sub="")
```
```{r}
#Mahalanobis, salto promedio
cs=hclust(d.MAH,method = "average")
plot(cs, xlab="", main="salto promedio Mahalanobis", ylab="Distancia", sub="")
```
```{r}
#Manhatan, salto promedio
cs=hclust(d.MANH,method = "average")
plot(cs, xlab="", main="salto promedio Manhatan", ylab="Distancia", sub="")
```
7. **Distancia de Ward:**
   Utilizamos la distancia de Ward para medir la distancia entre grupos (`method=”ward.D”` en `hclust`) y obtenemos los dendrogramas correspondientes.
```{r}
#Euclidea, Distancia de Ward
cs= hclust(d.EU,method = "ward.D")
plot(cs, xlab="", main="Distancia de Ward Euclidea", ylab="Distancia", sub="")
```
```{r}
#Mahalanobis, Distancia de Ward
cs=hclust(d.MAH,method = "ward.D")
plot(cs, xlab="", main="Distancia de Ward Mahalanobis", ylab="Distancia", sub="")
```
```{r}
#Manhatan, Distancia de Ward
cs=hclust(d.MANH,method = "ward.D")
plot(cs, xlab="", main="Distancia de Ward Manhatan", ylab="Distancia", sub="")
```
